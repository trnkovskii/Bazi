BARANJE1.

CREATE VIEW ZAD1 (PROSEK) AS
SELECT AVG(DURATION)
FROM SCHEDULED_TALKS


SELECT C_ID, DURATION
FROM SCHEDULED_TALKS, ZAD1
WHERE DURATION > ZAD1.PROSEK


BARANJE2.

SELECT CUSTOMER.C_SSN, COUNT(DISTINCT STOCK.C_PRODUCT_CODE)
FROM PURCHASE , CUSTOMER, STOCK , STORE_REVIEW 
WHERE PURCHASE.PRODUCT_ID = STOCK.C_PRODUCT_CODE AND PURCHASE.CUSTOMER_SSN = CUSTOMER.C_SSN
									AND STORE_REVIEW.STORE_ID = STOCK.STORE_ID 
                                    AND STORE_REVIEW.GRADE > (SELECT AVG(GRADE)
													FROM STORE_REVIEW 
													WHERE CUSTOMER.C_SSN = STORE_REVIEW.C_CUSTOMER_ID)
GROUP BY (CUSTOMER.C_SSN)
                 

BARANJE3.

CREATE VIEW PROBA (ID, KATEGORIJA, KOLICINA) AS
SELECT PRODUCT.C_CODE, PRODUCT.CATEGORY_ID, PURCHASE.QUANTITY
FROM PRODUCT 
INNER JOIN PURCHASE ON PRODUCT.C_CODE = PURCHASE.PRODUCT_ID


CREATE VIEW SUMA(ID, SUMA, KATEGORIJA) AS
SELECT ID, SUM(KOLICINA), KATEGORIJA
FROM PROBA GROUP BY ID, KATEGORIJA


SELECT SUMA.ID, PRODUCT.NAME, SUMA.KATEGORIJA, PRODUCT.PRICE, PRODUCT.COUNTRY, MAX(SUMA.SUMA)
FROM SUMA, PRODUCT
WHERE PRODUCT.C_CODE = SUMA.ID
GROUP BY SUMA.ID, SUMA.SUMA, SUMA.KATEGORIJA, PRODUCT.NAME, PRODUCT.PRICE, PRODUCT.COUNTRY
HAVING SUMA >= (SELECT MAX(SUMA)
               FROM SUMA
               )
			   

BARANJE4.

SELECT STORE.*
FROM STORE JOIN STORE_REVIEW SR ON STORE.ID = SR.STORE_ID 
        JOIN PURCHASE P ON SR.C_CUSTOMER_ID = P.CUSTOMER_SSN
WHERE GRADE > ANY(SELECT GRADE
                 FROM STORE_REVIEW
                 WHERE GRADE > 1)
      AND QUANTITY > 1


BARANJE5.

CREATE VIEW PRODAVAC(SSN, DURATION) AS
SELECT AGENT_SELLER_SSN, SUM(DURATION)
FROM SCHEDULED_TALKS GROUP BY AGENT_SELLER_SSN


SELECT SSN, MAX(DURATION)
FROM PRODAVAC
GROUP BY SSN, DURATION
HAVING DURATION >= (SELECT MAX(DURATION)
                   FROM PRODAVAC
                   )
				   
BARANJE6.

CREATE VIEW NAJSKAPA(PRODUCT_ID, CENA, STORE_ID, COUNT1) AS 
SELECT P.C_CODE, AVG(P.PRICE), S.STORE_ID, S.COUNT
FROM PRODUCT P
INNER JOIN STOCK S ON P.C_CODE = S.C_PRODUCT_CODE
GROUP BY P.C_CODE, P.PRICE, S.STORE_ID, S.COUNT


CREATE VIEW PROSECNO(STORE_ID, PROSECNACENA) AS 
SELECT STORE_ID, AVG(CENA)
FROM NAJSKAPA GROUP BY STORE_ID

SELECT PROSECNO.STORE_ID, MAX(PROSECNO.PROSECNACENA), STORE.NAME, STORE.ADDRESS, STOCK.C_PRODUCT_CODE, STOCK.COUNT, PRODUCT.NAME, PRODUCT.PRICE
FROM PROSECNO, STORE, STOCK, PRODUCT
WHERE PROSECNO.STORE_ID=STORE.C_ID AND PROSECNO.STORE_ID=STOCK.STORE_ID AND STOCK.C_PRODUCT_CODE=PRODUCT.C_CODE
GROUP BY PROSECNO.STORE_ID, PROSECNO.PROSECNACENA, STORE.NAME, STORE.ADDRESS, STOCK.C_PRODUCT_CODE, STOCK.COUNT, PRODUCT.NAME, PRODUCT.PRICE
HAVING PROSECNACENA >= (SELECT MAX(PROSECNACENA)
                       FROM PROSECNO)



DOPOLNITELNO1:
1: CREATE VIEW PROSEK100(PROSEK) AS 
SELECT AVG(PURCHASE.QUANTITY * PRODUCT.PRICE) AS PROSEK
FROM PURCHASE, PRODUCT

2: SELECT CUSTOMER_SSN, PURCHASE.QUANTITY * PRODUCT.PRICE AS PR
FROM PURCHASE, PROSEK100,PRODUCT
WHERE PURCHASE.QUANTITY * PRODUCT.PRICE < PROSEK100.PROSEK


DOPOLNITELNO2:
1: CREATE VIEW DOP(CATEGORY_ID, PRICE) AS 
SELECT CATEGORY_ID, MAX(PRICE)
FROM PRODUCT GROUP BY CATEGORY_ID

2: SELECT PRODUCT.NAME, DOP.PRICE, DOP.CATEGORY_ID
FROM PRODUCT, DOP
WHERE PRODUCT.CATEGORY_ID = DOP.CATEGORY_ID AND PRODUCT.PRICE = DOP.PRICE




DOPOLNITELNI:

1. PRIKAZHI GO IZNOSOT I MATICHNITE BROEVI NA KUPUVACITE KOI KUPILE ROBA VO IZNOS POGOLEM OD PROSECNIOT IZNOS OD SITE KUPUVACI;
	
	
	
	
2. PRIKAZHI GO SEKOJ KUPUVACH ZA KOJ VAZHI DEKA PROSECHNIOT IZNOS NA KUPUVANJATA ZA KOJ E ODGOVOREN E NAD PROSECHNIOT IZNOS NA SITE KUPUVANJA;

SELECT CUSTOMER_SSN, PRODUCT_ID, QUANTITY, PRICE, CATEGORY_ID, AVG(QUANTITY * PRICE) AS 'SUMA'
FROM PURCHASE, PRODUCT 
WHERE PURCHASE.PRODUCT_ID = PRODUCT.C_CODE 
GROUP by CUSTOMER_SSN
HAVING SUMA> 
		(SELECT AVG(QUANTITY * PRICE) 
		FROM PURCHASE, PRODUCT 
		WHERE PRODUCT.C_CODE = PURCHASE.PRODUCT_ID )